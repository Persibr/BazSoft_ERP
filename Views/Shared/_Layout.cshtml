<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - Sistema</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="~/adminlte/plugins/fontawesome-free/css/all.min.css" />
    @* <link rel="stylesheet" href="~/adminlte/plugins/icheck-bootstrap/icheck-bootstrap.min.css" /> *@
    <link rel="stylesheet" href="~/adminlte/dist/css/adminlte.min.css" />
    <link rel="stylesheet" href="~/adminlte/plugins/sweetalert2/sweetalert2.css" />
    <link href="~/adminlte/plugins/select2/css/select2.min.css" rel="stylesheet" />
 
    @RenderSection("Styles", required: false)
</head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
            </ul>
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" asp-controller="UsuarioLogon" asp-action="Logout">Cerrar Sesión</a>
                </li>
            </ul>
        </nav>

        <!-- Sidebar -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <a href="@Url.Action("Index", "Dashboard")" class="brand-link">
                <img src="~/adminlte/dist/img/AdminLTELogo.png" alt="AdminLTE Logo"
                     class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">Cobranzas</span>
            </a>

            <div class="sidebar">
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="info">
                        @{
                            var nombre = Context.Session.GetString("Nombre");
                            var id = Context.Session.GetInt32("IdUsuario");
                        }

                        @if (!string.IsNullOrEmpty(nombre))
                        {
                            <a href="#" class="d-block">@nombre</a>
                        }
                    </div>
                </div>

                <div class="form-inline">
                    <div class="input-group" data-widget="sidebar-search">
                        <input class="form-control form-control-sidebar" type="search" placeholder="Buscar" aria-label="Buscar">
                        <div class="input-group-append">
                            <button class="btn btn-sidebar">
                                <i class="fas fa-search fa-fw"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Menú dinámico -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false" id="menu-dinamico">
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Contenido principal -->
        <div class="content-wrapper">
            @RenderBody()
        </div>

        <!-- Footer -->
        @*   <footer class="main-footer">
            <strong>© 2025 - Sistema</strong>
        </footer> *@
    </div>

    <!-- Scripts -->
    <script src="~/adminlte/plugins/jquery/jquery.min.js"></script>
    <script src="~/adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/adminlte/dist/js/adminlte.min.js"></script>
    
    @* <script src="~/adminlte/dist/js/demo.js"></script> *@
    @* <script src="~/adminlte/dist/js/pages/dashboard3.js"></script> *@
    <script src="~/adminlte/plugins/select2/js/select2.full.min.js"></script>
    <script src="~/adminlte/plugins/sweetalert2/sweetalert2.js"></script>

    <script>
        // $(function () {
        //    // $("#menu-dinamico").load("/Layout/CargarMenu");
        //      $("#menu-dinamico").load('@Url.Action("CargarMenu", "Layout")');
        // });
        const tiempoExpiracion = 30 * 60 * 1000; // 30 minutos
        let temporizador;
        const appBaseUrl = '@Url.Content("~/")';


        function reiniciarTemporizador() {
            clearTimeout(temporizador);
            temporizador = setTimeout(() => {
                Swal.fire({
                    icon: 'warning',
                    title: 'Sesión expirada',
                    text: 'Tu sesión ha expirado por inactividad.',
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    confirmButtonText: 'Entendido'
                }).then(() => {
                    window.location.href = appBaseUrl + 'UsuarioLogon/Login';
                });
            }, tiempoExpiracion);
        }

        $(function () {
            // Cargar menú dinámico solo si hay sesión (opcional validación previa)
            // $("#menu-dinamico").load('@Url.Action("CargarMenu", "Layout")');
            $("#menu-dinamico").load('@Url.Action("CargarMenu", "Layout")', function (response, status, xhr) {
                if (xhr.status === 401) {
                    // Si no hay sesión → redirigir la página completa al login
                    window.location.href = '@Url.Action("Login", "UsuarioLogon")';
                }
            });

            // Escuchar eventos de actividad
            ['click', 'mousemove', 'keydown', 'scroll'].forEach(evt => {
                document.addEventListener(evt, reiniciarTemporizador, false);
            });

            // Iniciar el temporizador
            reiniciarTemporizador();
        });
    </script>

    @RenderSection("Scripts", required: false)
</body>

</html>
