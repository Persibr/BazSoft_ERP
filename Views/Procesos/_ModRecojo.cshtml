@model Bazsoft_ERP.Models.Recojo

<div class="modal fade" id="modalRecojo" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h6 class="modal-title" id="modalRecojoLabel">Recojo</h6>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <form asp-controller="Procesos" asp-action="RecojoAccion" method="post" id="formRecojo">
                    <input type="hidden" asp-for="IdNotaCifrado" />
                    <div class="row">
                        <div class="col-md-10">
                            
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    <label class="small font-weight-bold">Fecha de Recojo</label>
                                    <input type="date" asp-for="FechaRecojo" class="form-control form-control-sm" />
                                </div>                               
                                <div class="col-md-5">
                                    <label class="small font-weight-bold">Cliente</label>
                                    <select asp-for="Clientes" asp-items="ViewBag.Clientes" class="form-control select2bs4 form-control-sm">
                                        <option value="">[Seleccione Cliente]</option>
                                    </select>
                                </div>
                                @* <div class="col-md-3">
                                    <label class="small font-weight-bold">Tipo de Servicio</label>
                                    <select asp-for="TipoServicio" asp-items="ViewBag.TiposServicio" class="form-control select2bs4 form-control-sm">
                                        <option value="">[Seleccione Tipo de Servicio]</option>
                                    </select>
                                </div> *@
                            </div>
                            <input type="hidden" name="DetallesJson" id="detallesJson" />
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label class="small font-weight-bold">Vehículo</label>
                                    <select asp-for="Vehiculos" asp-items="ViewBag.Vehiculos" class="form-control select2bs4 form-control-sm ">
                                        <option value="">[Seleccione Vehículo]</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-4">
                                    <label class="small font-weight-bold">Documento</label>
                                    <select asp-for="Documentos" asp-items="ViewBag.Documentos" class="form-control form-control-sm select2bs4">
                                        <option value="">[Seleccione Documento]</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-2">
                                    <label class="small font-weight-bold">Serie</label>
                                    <input type="text" class="form-control form-control-sm" asp-for="Serie" />
                                </div>
                                <div class="form-group col-md-3">
                                    <label class="small font-weight-bold">Correlativo</label>
                                    <input type="text" class="form-control form-control-sm" asp-for="Correlativo" />
                                </div>
                                <div class="form-group col-md-3">
                                    <label class="small font-weight-bold">Fecha Guía</label>
                                    <input type="date" asp-for="FechaGuia" class="form-control form-control-sm" />
                                    @* value="@(ViewBag.fechaGuia ?? DateTime.Today.ToString("yyyy-MM-dd"))" /> *@
                                </div>
                            </div>

                        </div>
                        <div class="col-md-2 d-flex flex-column align-items-end justify-content-center mt-4">
                            <button type="submit" class="btn btn-primary btn-sm w-100 mb-2">
                                <i class="fas fa-save"></i> Grabar Registro
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100" data-dismiss="modal">
                                <i class="fas fa-times"></i> Salir
                            </button>
                        </div>

                    </div>
                </form>

                <hr class="my-3" />
               @*  <div class="card mb-3">
                    <div class="card-body py-2">
                        <div class="form-row">
                            <div class="form-group col-md-3 mb-1">
                                <label class="small font-weight-bold">Producto</label>
                                <select id="productoSelect" name="Producto" asp-items="ViewBag.Productos" class="form-control form-control-sm ">
                                    <option value="">[Seleccione Producto]</option>
                                </select>
                            </div>                            
                            <div class="form-group col-md-2 mb-1">
                                <label class="small font-weight-bold">Medida</label>
                                <input id="unidadMedidainput" type="text" class="form-control form-control-sm text-end" name="Medida"/>
                            </div>
                            <div class="form-group col-md-2 mb-1">
                                <label class="small font-weight-bold">Cantidad</label>
                                <input id="cantJabInput" type="number" class="form-control form-control-sm text-end" name="CantJab" min="0" />
                            </div>
                            <div class="form-group col-md-2 mb-1 d-flex align-items-end justify-content-center">
                                <button type="button" class="btn btn-success btn-sm mr-1" id="btnAgregarDetalle"><i class="fas fa-check"></i></button>
                                <button type="button" id="btnCancelarEdicion" class="btn btn-danger btn-sm" title="Cancelar">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div> *@

                <div class="table-responsive">
                    <table id="tablaProductos" class="table table-sm table-bordered table-striped small text-center">
                        <thead class="table-secondary">
                            <tr>
                                <th>Producto</th>
                                <th>Medida</th>
                                <th>Cantidad</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
       const productos = @Html.Raw(ViewBag.ProductosJson);
       console.log(productos);
    $('#modalRecojo').on('shown.bs.modal', function () {
        const tbody = document.querySelector("#tablaProductos tbody");
        tbody.innerHTML = "";

        productos.forEach(p => {
            let row = `
                <tr data-id="${p.Id}">
                    <td>${p.Descripcion}</td>
                    <td>${p.Unidad}</td>
                    <td>
                        <input type="number"
                               class="form-control form-control-sm text-end"
                               name="Cantidad_${p.Id}"
                               value="0" min="0" />
                    </td>
                </tr>`;
            tbody.insertAdjacentHTML("beforeend", row);
        });
    });

</script>
